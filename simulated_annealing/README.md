# Own Tournament Draw Algorithm (Simulated Annealing)

This script implements a **custom tournament draw generator** using  
**Simulated Annealing (Boltzmann optimization)**.  
It improves draw fairness by minimizing a **penalty function** that tracks:
- Repeated group assignments (player history)
- Repeated pairings, triples, and quadruples
- Same-club players in the same group
- Club clustering in knockout halves/quarters (light penalty)

---

## Functionality

- Loads player list from Excel (`players.xlsx` or `players_example.xlsx`)
- Places seeded players in fixed groups according to rules:
  - Seed 1 → Group A
  - Seed 2 → Group B
  - Seeds 3/4 → Groups C or D (randomized)
  - Seeds 5/8 → Groups E–H (randomized)
- Fills remaining groups with unseeded players
- Evaluates draws with a **penalty function**
- Optimizes via **Simulated Annealing**:
  - Starts with a random valid draw
  - Iteratively swaps players between groups
  - Accepts better solutions, and sometimes worse ones (Boltzmann probability)
  - Gradually lowers temperature → exploration → exploitation
- Logs the **penalty progression** across simulations
- Saves results to CSV and Excel

---

## Dependencies

- Input: `players.xlsx` (must contain the columns `Name`, `Seed`, `Club`)
- Output: 
  - `own_draws.xlsx` → all valid draws
  - `draws_temp.csv` → intermediate results
  - `penalty_history.csv` → penalty progression

- Python 3.x
- `pandas` – data handling
- `numpy` – numerical operations
- `tqdm` – progress bars
- `openpyxl` – Excel backend
- `plotly` – for visualization of penalty progression
- Standard library modules: `os`, `random`, `math`, `itertools`, `collections`

Install required packages with:
```bash
pip install pandas numpy tqdm openpyxl plotly
```

---

## Usage
1. Prepare the input file
     - Create an Excel file named `players.xlsx` (or copy and rename [`players_example.xlsx`](baseline/players_example.xlsx) from the `baseline/` folder).
     - The file *must* contain the columns: `Name`, `Seed`, `Club`.
2. Customize the script
     - Open `own_algorithm.py` and update the file paths to match your system:
```python
input_file   = r"D:\Maturaarbeit\spielerliste.xlsx"
csv_file     = r"D:\Maturaarbeit\draws_temp.csv"
excel_file   = r"D:\Maturaarbeit\own_draws.xlsx"
penalty_file = r"D:\Maturaarbeit\penalty_history.csv"
```
  - Adjust key parameters if desired:
      - `n_groups` -> number of groups (default: 11)
      - `group_sizes` -> group sizes (default: 10x3 + 1x4)
      - `n_sim` -> number of simulations (e.g. 100)
      - `MAX_ITER` -> iterations per simulation (default: 200)
3. Run the script
```bash
python own_algorithm.py
```
4. Outputs
```markdown
      - `own_draws.xlsx` -> final results (same output format as the result from `draw_parser.py` to compare the results).
      - `draws_temp.csv` -> incremental draws
      - `penalty_history.csv` -> penalty progression (per simulation/iteration)
```
---

## Visualization of Penalty Progression
A separate script (`plot_penalty_progression.py`) allows you to **visualize how the penalty evolves over iterations** for each simulation.  
It uses the output `penalty_history.csv` generated by the main algorithm.

### Features
  - Interactive Plotly plot
  - Two modes:
    - `"all"`    : shows every simulation individually
    - `"sample"` : shows the median line, 10–90% percentile band, and a sample of random simulations
  - Hover over the lines to see simulation number, iteration, and penalty value

### Usage
1. Open the script in an editor and adjust the path to your penalty history CSV:
```python
penalty_file = r"D:\Maturaarbeit\penalty_history.csv"
```
2. Choose the mode:
```python
mode = "all"     # or "sample"
sample_size = 10 # used only in sample mode
```

3. Run the script:
```bash
python plot_penalty_progression.py
```

An interactive Plotly plot will open showing the penalty progression.


---

## Example Input
An example player list (`players_example.xlsx`) is available in the `baseline_random_sampling/` folder. The example Excel file contains 34 players (8 seeded + 26 unseeded) with corresponding clubs.

To test this algorithm, copy and rename it to `players.xlsx` in this folder.

---

## Limitations
  - Optimized for *34 players* (8 seeded + 26 unseeded).
  - Other sizes may require adjusting `n_groups` and `group_sizes`.
  - Runtime increases with `n_sim` and `MAX_ITER`.
  - Results are *stochastic*: repeated runs may give different outputs.







