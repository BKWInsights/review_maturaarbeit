# Tournament Draw Evaluation & Visualization

This folder contains scripts for evaluating the fairness and randomness of badminton tournament draws and for visualizing the results using heatmaps.

---

## 1. Tournament Draw Evaluation (MRV Heuristic)

This script evaluates the fairness and randomness of badminton tournament draws using **statistical tests**.  
It implements a **Monte Carlo simulation with MRV (Minimum Remaining Values) heuristic** to assign players into groups under seed and club constraints.  

Unlike rejection sampling (too slow for large datasets), this method works well and runs quickly.

---

### Data Requirements

- Input: `evaluation_of_draws.xlsx` (Excel file)
  - The script loads **sheet 5** (last sheet), which contains:
    - `Name` – player names
    - `Group` – assigned groups
    - `Count` – number of times a player appeared in a group
    - `Club` – club affiliation
    - `Seed` – seeding status (`1`, `2`, `3/4`, `5/8`, or unseeded)

**Note:** This sheet is generated from the `draw_statistics` step (Chi² test).  
Make sure it exists before running this script.

---

### Methodology

#### Group Slots
- Groups **A–K** are defined with fixed free slots for **unseeded players**:
  "A": 2, "B":2, "C": 2, "D": 2,
  "E": 2, "F": 2, "G": 3, "H": 2,
  "I": 3, "J": 3, "K": 3

#### Seed Rules
- Seed `1` → must go to Group A  
- Seed `2` → must go to Group B  
- Seed `3/4` → Groups C or D  
- Seed `5/8` → Groups E–H  
- Unseeded → placed probabilistically in remaining slots

#### Monte Carlo MRV Simulation
- Iterates over **10,000 simulations** (`n_sim`)
- Uses **MRV heuristic**:
- Assigns the player with the smallest domain of valid groups first
- Enforces seed placement and avoids same-club conflicts
- Falls back to “softer rules” if no valid assignment is found

#### Statistical Evaluation
For each player:
- **Chi² test**: compares observed vs. expected distribution (theoretical and simulated)
- **Cramér’s V**: effect size for Chi²
- **t-test**: compares observed group counts to simulation means
- **F-test**: compares variance of observed vs. simulated distributions
- **95% interval check**: whether observed counts fall within simulated confidence intervals

---

### Outputs

The script generates an Excel file:

**`simulation_results.xlsx`**
- **Detail sheet** – per player & group:
- Observed vs. expected counts
- Simulated probabilities
- Variance, standard deviation
- 95% confidence intervals
- t- and F-test results
- **Summary sheet** – per player:
- Chi² test results
- Cramér’s V (theoretical & simulated)
- % of groups within 95% interval
- Variance comparison (F-test)

---

### Notes
- `from vergleichsbasis_random import monte_carlo_random, get_full_slots` is **commented out**.  
- These functions implement a **rejection sampling baseline** but are too slow for large datasets.  
- Therefore, this version focuses only on the **MRV heuristic**.
- The comparison block at the end (`df_compare`) is also commented out, as it relies on the random baseline.

---

### Usage

1. Prepare the input file
   - Make sure `evaluation_of_draws.xlsx` exists in `D:\Maturaarbeit\`
   - This file must be generated by the **draw_statistics** script (last sheet contains the Chi² test results).

2. Run the script
```bash
python tournament_eval_mrv.py

```

### Dependencies

- Python 3.x
- `pandas` - data handling
- `numpy` - numerical computations
- `scipy` - statistical tests
- `openpyxl` - required Excel backend
- Standard libraries: `math`, `random`

---

## 2. Tournament Draw Visualization (Heatmaps)
This script visualizes observed vs. expected distributions of players across groups with **Plotly heatmaps**.
---
### Data Requirements
- **Input**: `simulation_results.xlsx`
  Must be generated by the `statistical_analysis` script.
  Required columns: `Player`, `Group`, `Observed`, `Expected_exact`, `Expected_simulated`.
  
---

## Heatmaps Generated
**1. Observed Distribution**
Heatmap of how often each player appeared in each group.
**2. Residuals (Observed - Expected Exact)**
Shows deviations from the exact expected probabilities.
**3. Residuals (Observed - Expected Simulated)**
Shows deviations from Monte Carlo simulated expectations.

---

### Usage
```bash
python heatmaps.py
```

---

### Outputs
- Three interactive heatmaps (open in browser via Plotly).
- Useful for spotting unfair player–group patterns visually.

---

### Dependencies
- Excel file created by `statistical_analysis.py`
- Python 3.x
- `pandas` -> data handling
- `plotly` -> interactive heatmaps
- Standard libraries: `math`, `random`

Install the required packages with:
```bash
pip install pandas plotly
```
